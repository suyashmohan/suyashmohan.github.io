<!DOCTYPE html><html><head><meta charset="utf-8"><title>Nginx Ingress setup for kubernetes | Farzi Coder</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="description" content="Recently I decided to give Kubernetes a try. I was avoiding it just for the reason of writing several long YAML files. I know I am a lazy guy. But once you get used to writing Kubernetes code, you dis"><meta name="keywords" content="Kubernetes,Containers"><meta property="og:type" content="article"><meta property="og:title" content="Nginx Ingress setup for kubernetes"><meta property="og:url" content="http://farzicoder.com/Nginx-Ingress-setup-for-kubernetes/index.html"><meta property="og:site_name" content="Farzi Coder"><meta property="og:description" content="Recently I decided to give Kubernetes a try. I was avoiding it just for the reason of writing several long YAML files. I know I am a lazy guy. But once you get used to writing Kubernetes code, you dis"><meta property="og:locale" content="default"><meta property="og:updated_time" content="2020-01-22T14:55:10.922Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Nginx Ingress setup for kubernetes"><meta name="twitter:description" content="Recently I decided to give Kubernetes a try. I was avoiding it just for the reason of writing several long YAML files. I know I am a lazy guy. But once you get used to writing Kubernetes code, you dis"><link rel="alternate" href="/atom.xml" title="Farzi Coder" type="application/atom+xml"><link rel="icon" href="/favicon.png"><link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet"><link rel="stylesheet" href="/css/style.css"><!-- Google Analytics --><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-100366340-1', 'auto');
ga('send', 'pageview');</script><!-- End Google Analytics --></head></html><body><div id="container"><div id="wrap"><header id="header"><div id="banner"></div><div id="header-outer" class="outer"><div id="header-title" class="inner"><h1 id="logo-wrap"><a href="/" id="logo">Farzi Coder</a></h1><h2 id="subtitle-wrap"><a href="/" id="subtitle">Adventures of a coder</a></h2></div><div id="header-inner" class="inner"><nav id="main-nav"><a id="main-nav-toggle" class="nav-icon"></a> <a class="main-nav-link" href="/">Home</a> <a class="main-nav-link" href="/archives">Archives</a></nav><nav id="sub-nav"><a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a> <a id="nav-search-btn" class="nav-icon" title="Search"></a></nav><div id="search-form-wrap"><form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://farzicoder.com"></form></div></div></div></header><div class="outer"><section id="main"><article id="post-Nginx-Ingress-setup-for-kubernetes" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-meta"><a href="/Nginx-Ingress-setup-for-kubernetes/" class="article-date"><time datetime="2020-01-22T17:14:00.000Z" itemprop="datePublished">2020-01-22</time></a><div class="article-category"><a class="article-category-link" href="/categories/Kubernetes/">Kubernetes</a></div></div><div class="article-inner"><header class="article-header"><h1 class="article-title" itemprop="name">Nginx Ingress setup for kubernetes</h1></header><div class="article-entry" itemprop="articleBody"><p>Recently I decided to give Kubernetes a try. I was avoiding it just for the reason of writing several long YAML files. I know I am a lazy guy. But once you get used to writing Kubernetes code, you discover the power of it. You do have to write a docker-compose file in the world of Docker but I have found writing YAML for Kubernetes more tedious but it might be worth it once you understand what more you can do with Kubernetes.</p><p>Like everyone the first thing I learned in Kubernetes is to create a deployment that serves a website and created a service around it. The first question that came in my mind afterward is how I can host 2 websites and route the traffic to them based on hostnames. Traditionally you would install something like NGINX and configure it to serve different websites or forward the requests to some other service. We can still use Nginx to route our request in Kubernetes but in a different way, by using Ingress.<br><a id="more"></a><br>In this article, we will have a look at Nginx Ingress Controller. Using this we can easily divert traffic based on hostnames inside our Kubernetes cluster essentially allowing us to host multiple projects on a single cluster. Isn’t it cool? Let me know in the comments if I am overselling it.</p><p>To test it out we will need to install and enable Nginx Ingress Controller. We will be using Minikiube to test on our local machine.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ minikube addons enable ingress</div></pre></td></tr></table></figure><p>Before we set up our Ingress controller we will need to set up deployments with corresponding services. Let’s Create a sample deployment and a service.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">apiVersion: apps/v1</div><div class="line">kind: Deployment</div><div class="line">metadata:</div><div class="line">  name: first-deployment</div><div class="line">spec:</div><div class="line">  replicas: 3</div><div class="line">  selector:</div><div class="line">    matchLabels:</div><div class="line">      app: first-deployment</div><div class="line">  template:</div><div class="line">    metadata:</div><div class="line">      labels:</div><div class="line">        app: first-deployment</div><div class="line">    spec:</div><div class="line">      containers:</div><div class="line">      - name: hello-kubernetes</div><div class="line">        image: paulbouwer/hello-kubernetes:1.5</div><div class="line">        ports:</div><div class="line">          - containerPort: 8080</div><div class="line">        env:</div><div class="line">        - name: MESSAGE</div><div class="line">          value: Hello from first Deployment</div><div class="line">---</div><div class="line">apiVersion: v1</div><div class="line">kind: Service</div><div class="line">metadata:</div><div class="line">  name: first-deployment</div><div class="line">spec:</div><div class="line">  type: ClusterIP</div><div class="line">  ports:</div><div class="line">  - port: 80</div><div class="line">    targetPort: 8080</div><div class="line">  selector:</div><div class="line">    app: first-deployment</div></pre></td></tr></table></figure><p>Similarly, let’s create one more deployment just by replacing the word <code>first</code> in the above text with the word <code>second</code>. Being lazy sometimes does save some time. If you are too lazy to type that also, then you can find the code in my repo <a href="https://github.com/suyashmohan/simple_kubernetes_ingress_sample" target="_blank" rel="external">https://github.com/suyashmohan/simple_kubernetes_ingress_sample</a></p><p>In case you are new to Kubernetes, you can deploy above YAML by using</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">kubectl apply -f first-deployment.yml</div><div class="line">kubectl apply -f second-deployement.yml</div></pre></td></tr></table></figure><p>You can check if everything is running fine by using</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">kubectl get pods</div><div class="line">kubectl get deployments</div><div class="line">kubectl get services</div></pre></td></tr></table></figure><p>If everything is looking fine let’s continue and setup our Ingress controllers. If you are stuck at any error, you can comment below and I will try to help you out.</p><p>Setting up Ingress is pretty easily</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">apiVersion: networking.k8s.io/v1beta1</div><div class="line">kind: Ingress</div><div class="line">metadata:</div><div class="line">  name: test-ingress</div><div class="line">  annotations:</div><div class="line">    nginx.ingress.kubernetes.io/rewrite-target: /$1</div><div class="line">spec:</div><div class="line">  rules:</div><div class="line">  - host: first.info</div><div class="line">    http:</div><div class="line">      paths:</div><div class="line">      - path: /</div><div class="line">        backend:</div><div class="line">          serviceName: first-deployment</div><div class="line">          servicePort: 8080</div><div class="line">  - host: second.info</div><div class="line">    http:</div><div class="line">      paths:</div><div class="line">      - path: /</div><div class="line">        backend:</div><div class="line">          serviceName: second-deployment</div><div class="line">          servicePort: 8080</div></pre></td></tr></table></figure><p>Here we have defined a resource with kind of Ingress. The specifications for this resource includes rules which defines how traffic should be diverted to different services based on host. For e.g. if a request comes for first.info with root path, we will forward the request to first-deployment at port 8080. Same goes for second.info</p><p>Apply the above ingress resource</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ kubectl apply -f ingress.yml</div></pre></td></tr></table></figure><p>Get the address for Ingress controller as following<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ kubectl get ingress</div><div class="line">NAME           HOSTS                    ADDRESS         PORTS   AGE</div><div class="line">test-ingress   first.info,second.info   192.168.39.98   80      57s</div></pre></td></tr></table></figure></p><p>One advantage of Ingress is that it exposes the controller, so you don’t have to expose the services to the world. Testing this setup is also pretty easy.</p><p>We can either set up these hosts in /etc/host/ pointing to local address or we can just Host header in curl to test it out.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ curl -H &apos;Host:first.info&apos; http://192.168.39.98</div><div class="line">$ curl -H &apos;Host:second.info&apos; http://192.168.39.98</div></pre></td></tr></table></figure><p>That’s it we have set up 2 services that get traffic based on Hostnames using Nginx Ingress Controller. I hope this article was helpful. Please share your thoughts and doubts using the comments below.</p></div><footer class="article-footer"><a data-url="http://farzicoder.com/Nginx-Ingress-setup-for-kubernetes/" data-id="ck5pf4txg0000ykedb0u32ry3" class="article-share-link">Share</a> <a href="http://farzicoder.com/Nginx-Ingress-setup-for-kubernetes/#disqus_thread" class="article-comment-link">Comments</a><ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Containers/">Containers</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Kubernetes/">Kubernetes</a></li></ul></footer></div><nav id="article-nav"><a href="/Writing-your-First-Smart-Contract-using-Solidity-Part-2-Getting-Started-with-Smart-Contracts-Blockchain/" id="article-nav-older" class="article-nav-link-wrap"><strong class="article-nav-caption">Older</strong><div class="article-nav-title">Writing your first Smart Contract using Solidity - Part 2 - Getting Started with Smart Contracts &amp; Blockchain</div></a></nav></article><section id="comments"><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div></section></section><aside id="sidebar"><div class="widget-wrap"><h3 class="widget-title">Categories</h3><div class="widget"><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Blockchain/">Blockchain</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Kubernetes/">Kubernetes</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Node-js/">Node.js</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Thoughts/">Thoughts</a></li></ul></div></div><div class="widget-wrap"><h3 class="widget-title">Tags</h3><div class="widget"><ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Blockchain/">Blockchain</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Containers/">Containers</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Ethereum/">Ethereum</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Express-js/">Express.js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Javascript/">Javascript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Kubernetes/">Kubernetes</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NPM/">NPM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Node-js/">Node.js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Smart-Contracts/">Smart Contracts</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Thoughts/">Thoughts</a></li></ul></div></div><div class="widget-wrap"><h3 class="widget-title">Tag Cloud</h3><div class="widget tagcloud"><a href="/tags/Blockchain/" style="font-size: 15px">Blockchain</a> <a href="/tags/Containers/" style="font-size: 10px">Containers</a> <a href="/tags/Ethereum/" style="font-size: 15px">Ethereum</a> <a href="/tags/Express-js/" style="font-size: 10px">Express.js</a> <a href="/tags/Javascript/" style="font-size: 20px">Javascript</a> <a href="/tags/Kubernetes/" style="font-size: 10px">Kubernetes</a> <a href="/tags/NPM/" style="font-size: 10px">NPM</a> <a href="/tags/Node-js/" style="font-size: 20px">Node.js</a> <a href="/tags/Smart-Contracts/" style="font-size: 15px">Smart Contracts</a> <a href="/tags/Thoughts/" style="font-size: 10px">Thoughts</a></div></div><div class="widget-wrap"><h3 class="widget-title">Archives</h3><div class="widget"><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a></li></ul></div></div><div class="widget-wrap"><h3 class="widget-title">Recent Posts</h3><div class="widget"><ul><li><a href="/Nginx-Ingress-setup-for-kubernetes/">Nginx Ingress setup for kubernetes</a></li><li><a href="/Writing-your-First-Smart-Contract-using-Solidity-Part-2-Getting-Started-with-Smart-Contracts-Blockchain/">Writing your first Smart Contract using Solidity - Part 2 - Getting Started with Smart Contracts &amp; Blockchain</a></li><li><a href="/Setting-up-Geth-Mist-TestRPC-Part-1-Getting-Start-with-Smart-Contracts/">Setting up Geth, Mist &amp; TestRPC - Part 1 - Getting Started with Smart Contracts &amp; Blockchain</a></li><li><a href="/Getting-Started-with-Smart-Contracts-Blockchain-Part-0-Understanding-Basics/">Getting Started with Smart Contracts &amp; Blockchain - Part 0 Understanding Basics</a></li><li><a href="/Callback-Hell-Promises-generators-Async-Await-in-Node-js-Javascript/">Callback Hell, Promises, Generators &amp; Async-Await in Node.js/Javascript</a></li></ul></div></div></aside></div><footer id="footer"><div class="outer"><div id="footer-info" class="inner">&copy; 2020 Suyash Mohan<br>Powered by <a href="http://hexo.io/" target="_blank">Hexo</a></div></div></footer></div><nav id="mobile-nav"><a href="/" class="mobile-nav-link">Home</a> <a href="/archives" class="mobile-nav-link">Archives</a></nav><script>var disqus_shortname = 'farzi-coder';
  
  var disqus_url = 'http://farzicoder.com/Nginx-Ingress-setup-for-kubernetes/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();</script><script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script><link rel="stylesheet" href="/fancybox/jquery.fancybox.css"><script src="/fancybox/jquery.fancybox.pack.js"></script><script src="/js/script.js"></script></div></body>